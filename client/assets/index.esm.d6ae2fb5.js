var m=["x","y","z"],u=function(t){Object.assign(this,{uniforms:{},geometry:{vertices:[{x:0,y:0,z:0}]},mode:0,modifiers:{},attributes:[],multiplier:1,buffers:[]}),Object.assign(this,t),this.prepareProgram(),this.prepareUniforms(),this.prepareAttributes()};u.prototype.compileShader=function(t,e){var r=this.gl.createShader(t);return this.gl.shaderSource(r,e),this.gl.compileShader(r),r},u.prototype.prepareProgram=function(){var t=this.gl,e=this.vertex,r=this.fragment,s=t.createProgram();t.attachShader(s,this.compileShader(35633,e)),t.attachShader(s,this.compileShader(35632,r)),t.linkProgram(s),t.useProgram(s),this.program=s},u.prototype.prepareUniforms=function(){for(var t=Object.keys(this.uniforms),e=0;e<t.length;e+=1){var r=this.gl.getUniformLocation(this.program,t[e]);this.uniforms[t[e]].location=r}},u.prototype.prepareAttributes=function(){this.geometry.vertices!==void 0&&this.attributes.push({name:"aPosition",size:3}),this.geometry.normal!==void 0&&this.attributes.push({name:"aNormal",size:3}),this.attributeKeys=[];for(var t=0;t<this.attributes.length;t+=1)this.attributeKeys.push(this.attributes[t].name),this.prepareAttribute(this.attributes[t])},u.prototype.prepareAttribute=function(t){for(var e=this.geometry,r=this.multiplier,s=e.vertices,i=e.normal,o=new Float32Array(r*s.length*t.size),h=0;h<r;h+=1)for(var a=t.data&&t.data(h,r),f=h*s.length*t.size,n=0;n<s.length;n+=1)for(var l=0;l<t.size;l+=1){var c=this.modifiers[t.name];o[f]=c!==void 0?c(a,n,l,this):t.name==="aPosition"?s[n][m[l]]:t.name==="aNormal"?i[n][m[l]]:a[l],f+=1}this.attributes[this.attributeKeys.indexOf(t.name)].data=o,this.prepareBuffer(this.attributes[this.attributeKeys.indexOf(t.name)])},u.prototype.prepareBuffer=function(t){var e=t.data,r=t.name,s=t.size,i=this.gl.createBuffer();this.gl.bindBuffer(34962,i),this.gl.bufferData(34962,e,35044);var o=this.gl.getAttribLocation(this.program,r);this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,s,5126,!1,0,0),this.buffers[this.attributeKeys.indexOf(t.name)]={buffer:i,location:o,size:s}},u.prototype.render=function(t){var e=this,r=this.uniforms,s=this.multiplier,i=this.gl;i.useProgram(this.program);for(var o=0;o<this.buffers.length;o+=1){var h=this.buffers[o],a=h.location,f=h.buffer,n=h.size;i.enableVertexAttribArray(a),i.bindBuffer(34962,f),i.vertexAttribPointer(a,n,5126,!1,0,0)}Object.keys(t).forEach(function(l){r[l].value=t[l].value}),Object.keys(r).forEach(function(l){var c=r[l];e.uniformMap[c.type](c.location,c.value)}),i.drawArrays(this.mode,0,s*this.geometry.vertices.length),this.onRender&&this.onRender(this)},u.prototype.destroy=function(){for(var t=0;t<this.buffers.length;t+=1)this.gl.deleteBuffer(this.buffers[t].buffer);this.gl.deleteProgram(this.program),this.gl=null};var g=function(t){var e=this,r=t||{},s=r.canvas;s===void 0&&(s=document.querySelector("canvas"));var i=r.context;i===void 0&&(i={});var o=r.contextType;o===void 0&&(o="experimental-webgl");var h=r.settings;h===void 0&&(h={});var a=s.getContext(o,Object.assign({alpha:!1,antialias:!1},i));Object.assign(this,{gl:a,canvas:s,uniforms:{},instances:new Map,shouldRender:!0}),Object.assign(this,{devicePixelRatio:1,clearColor:[1,1,1,1],position:{x:0,y:0,z:2},clip:[.001,100]}),Object.assign(this,h),this.uniformMap={float:function(f,n){return a.uniform1f(f,n)},vec2:function(f,n){return a.uniform2fv(f,n)},vec3:function(f,n){return a.uniform3fv(f,n)},vec4:function(f,n){return a.uniform4fv(f,n)},mat2:function(f,n){return a.uniformMatrix2fv(f,!1,n)},mat3:function(f,n){return a.uniformMatrix3fv(f,!1,n)},mat4:function(f,n){return a.uniformMatrix4fv(f,!1,n)}},a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.getContextAttributes().alpha===!1&&(a.clearColor.apply(a,this.clearColor),a.clearDepth(1)),this.onSetup&&this.onSetup(a),window.addEventListener("resize",function(){return e.resize()}),this.resize(),this.render()};g.prototype.resize=function(){var t=this.gl,e=this.canvas,r=this.devicePixelRatio,s=this.position;e.width=e.clientWidth*r,e.height=e.clientHeight*r;var i=t.drawingBufferWidth,o=t.drawingBufferHeight,h=i/o;t.viewport(0,0,i,o);var a=Math.tan(Math.PI/180*22.5),f=[1,0,0,0,0,1,0,0,0,0,1,0,s.x,s.y,(h<1?1:h)*-s.z,1];this.uniforms.uProjectionMatrix={type:"mat4",value:[.5/a,0,0,0,0,h/a*.5,0,0,0,0,-(this.clip[1]+this.clip[0])/(this.clip[1]-this.clip[0]),-1,0,0,-2*this.clip[1]*(this.clip[0]/(this.clip[1]-this.clip[0])),0]},this.uniforms.uViewMatrix={type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},this.uniforms.uModelMatrix={type:"mat4",value:f}},g.prototype.toggle=function(t){t!==this.shouldRender&&(this.shouldRender=t!==void 0?t:!this.shouldRender,this.shouldRender&&this.render())},g.prototype.render=function(){var t=this;this.gl.clear(16640),this.instances.forEach(function(e){e.render(t.uniforms)}),this.onRender&&this.onRender(this),this.shouldRender&&requestAnimationFrame(function(){return t.render()})},g.prototype.add=function(t,e){e===void 0&&(e={uniforms:{}}),e.uniforms===void 0&&(e.uniforms={}),Object.assign(e.uniforms,JSON.parse(JSON.stringify(this.uniforms))),Object.assign(e,{gl:this.gl,uniformMap:this.uniformMap});var r=new u(e);return this.instances.set(t,r),r},g.prototype.remove=function(t){var e=this.instances.get(t);e!==void 0&&(e.destroy(),this.instances.delete(t))},g.prototype.destroy=function(){var t=this;this.instances.forEach(function(e,r){e.destroy(),t.instances.delete(r)}),this.toggle(!1)};var w="phi",E="theta",z="mapSamples",C="mapBrightness",M="baseColor",R="markerColor",B="glowColor",d="markers",P="diffuse",v="devicePixelRatio",S="dark",A={[w]:"z",[E]:"A",[z]:"j",[C]:"C",[M]:"J",[R]:"K",[B]:"x",[P]:"D",[S]:"E"},{PI:p,sin:y,cos:x}=Math,b=t=>[].concat(...t.map(e=>{let[r,s]=e.location;r=r*p/180,s=s*p/180-p;let i=x(r);return[-i*x(s),y(r),i*y(s),e.size]}),[0,0,0,0]),F=(t,e)=>{let r=(i,o)=>({type:i,value:e[o]}),s=new g({canvas:t,context:{alpha:!0,stencil:!1,antialias:!0,depth:!1,preserveDrawingBuffer:!1},settings:{[v]:e[v]||1,onSetup:i=>{let o=i.RGB,h=i.UNSIGNED_BYTE,a=i.TEXTURE_2D,f=i.createTexture();i.bindTexture(a,f),i.texImage2D(a,0,o,1,1,0,o,h,new Uint8Array([0,0,0,0]));let n=new Image;n.onload=()=>{i.bindTexture(a,f),i.texImage2D(a,0,o,o,h,n),i.generateMipmap(a);let l=i.getParameter(i.CURRENT_PROGRAM),c=i.getUniformLocation(l,"F");i.texParameteri(a,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(a,i.TEXTURE_MAG_FILTER,i.NEAREST),i.uniform1i(c,0)},n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAACAAQAAAADMzoqnAAAAAXNSR0IArs4c6QAABA5JREFUeNrV179uHEUAx/Hf3JpbF+E2VASBsmVKTBcpKJs3SMEDcDwBiVJAAewYEBUivIHT0uUBIt0YCovKD0CRjUC4QfHYh8hYXu+P25vZ2Zm9c66gMd/GJ/tz82d3bk8GN4SrByYF2366FNTACIAkivVAAazQdnf3MvAlbNUQfOPAdQDvSAimMWhwy4I2g4SU+Kp04ISLpPBAKLxPyic3O/CCi+Y7rUJbiodcpDOFY7CgxCEXmdYD2EYK2s5lApOx5pEDDYCUwM1XdJUwBV11QQMg59kePSCaPAASQMEL2hwo6TJFgxpg+TgC2ymXPbuvc40awr3D1QCFfbH9kcoqAOkZozpQo0aqAGQRKCog/+tjkgbNFEtg2FffBvBGlSxHoAaAa1u6X4PBAwDiR8FFsrQgeUhfJTSALaB9jy5NCybJPn1SVFiWk7ywN+KzhH1aKAuydhGkbEF4lWohLXDXavlyFgHY7LBnLRdlAP6BS5Cc8RfVDXbkwN/oIvmY+6obbNeBP0JwTuMGu9gTzy1Q4RS/cWpfzszeYwd+CAFrtBW/Hur0gLbJGlD+/OjVwe/drfBxkbbg63dndEDfiEBlAd7ac0BPe1D6Jd8dfbLH+RI0OzseFB5s01/M+gMdAeluLOCAuaUA9Lezo/vSgXoCX9rtEiXnp7Q1W/CNyWcd8DXoS6jH/YZ5vAJEWY2dXFQe2TUgaFaNejCzJ98g6HnlVrsE58sDcYqg+9XY75fPqdoh/kRQWiXKg8MWlJQxUFMPjqnyujhFBE7UxIMjyszk0QwQlFsezImsyvUYYYVED2pk6m0Tg8T04Fwjk2kdAwSACqlM6gRRt3vQYAFGX0Ah7Ebx1H+MDRI5ui0QldH4j7FGcm90XdxD2Jg1AOEAVAKhEFXSn4cKUELurIAKwJ3MArypPscQaLhJFICJ0ohjDySAdH8AhDtCiTuMycH8CXzhH9jUACAO5uMhoAwA5i+T6WAKmmAqnLy80wxHqIPFYpqCwxGaYLt4Dyievg5kEoVEUAhs6pqKgFtDQYOuaXypaWKQfIuwwoGSZgfLsu/XAtI8cGN+h7Cc1A5oLOMhwlIPXuhu48AIvsSBkvtV9wsJRKCyYLfq5lTrQMFd1a262oqBck9K1V0YjQg0iEYYgpS1A9GlXQV5cykwm4A7BzVsxQqo7E+zCegO7Ma7yKgsuOcfKbMBwLC8wvVNYDsANYalEpOAa6zpWjTeMKGwEwC1CiQewJc5EKfgy7GmRAZA4vUVGwE2dPM/g0xuAInE/yG5aZ8ISxWGfYigUVbdyBElTHh2uCwGdfCkOLGgQVBh3Ewp+/QK4CDlR5Ws/Zf7yhCf8pH7vinWAvoVCQ6zz0NX5V/6GkAVV+2/5qsJ/gU8bsxpM8IeAQAAAABJRU5ErkJggg=="}}});return s.add("",{vertex:"attribute vec3 aPosition;uniform mat4 uProjectionMatrix;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;void main(){gl_Position=uProjectionMatrix*uModelMatrix*uViewMatrix*vec4(aPosition,1.);}",fragment:"precision highp float;uniform vec2 u;uniform vec3 J,K,x;uniform vec4 y[64];uniform float z,A,j,B,C,D,E;uniform sampler2D F;float G=1./j;mat3 H(float a,float b){float c=cos(a),d=cos(b),e=sin(a),f=sin(b);return mat3(d,f*e,-f*c,0.,c,e,f,d*-e,d*c);}vec3 v(vec3 a,out float w){a=a.xzy;float n=max(2.,floor(log2(2.236068*j*3.141593*(1.-a.z*a.z))*.72021));vec2 e=floor(pow(1.618034,n)/2.236068*vec2(1.,1.618034)+.5),b=fract((e+1.)*.618034)*6.283185-3.883222,c=-2.*e,d=vec2(atan(a.y,a.x),a.z-1.),o=floor(vec2(c.y*d.x-b.y*(d.y*j+1.),-c.x*d.x+b.x*(d.y*j+1.))/(b.x*c.y-c.x*b.y));float l=3.141593;vec3 p;for(float f=0.;f<4.;f+=1.){vec2 q=vec2(mod(f,2.),floor(f*.5));float h=dot(e,o+q);if(h>j)continue;int r=int(h)*-1640531527;float s=float(r)*2.328306e-10,i=s*6.283185,g=1.-2.*h*G,k=sqrt(1.-g*g);vec3 m=vec3(cos(i)*k,sin(i)*k,g);float t=length(a-m);if(t<l)l=t,p=m;}w=l;return p.xzy;}void main(){vec2 a=gl_FragCoord.xy/u*2.-1.;a.x*=u.x/u.y;float c=dot(a,a),b;vec3 d=vec3(0.,0.,1.),e=normalize(vec3(a,sqrt(.64-c)));if(c<=.64){vec3 f=e*H(A,z),g=v(f,b);float k=asin(g.y),h=acos(-g.x/cos(k));h=g.z<0.?-h:h;float s=texture2D(F,vec2(h*.5/3.141593,-(k/3.141593+.5))).x,t=smoothstep(8e-3,0.,b),l=dot(e,d),r=pow(l,D)*C,m=s*t*r,L=mix((1.-m)*pow(l,.4),m,E)+.1;gl_FragColor=vec4(J*L,1.);int M=int(B);float n=0.;for(int i=0;i<64;i++){if(i>=M)break;vec4 o=y[i];vec3 p=o.xyz,w=p-f;float q=o.w;if(dot(w,w)>q*q*4.)continue;vec3 N=v(p,b);b=length(N-f),b<q?n+=smoothstep(q*.5,0.,b):0.;}n=min(1.,n*r),gl_FragColor.xyz=mix(gl_FragColor.xyz,K,n),gl_FragColor.xyz+=pow(1.-dot(e,d),4.)*x;}float I=pow(dot(normalize(vec3(-a,sqrt(1.-c))),d),4.)*smoothstep(.1,1.,.2/(c-.64));gl_FragColor+=vec4(I*x,I);}",uniforms:{u:{type:"vec2",value:[e.width,e.height]},z:r("float",w),A:r("float",E),j:r("float",z),C:r("float",C),J:r("vec3",M),K:r("vec3",R),D:r("float",P),x:r("vec3",B),E:r("float",S),y:{type:"vec4",value:b(e[d])},B:{type:"float",value:e[d].length}},mode:4,geometry:{vertices:[{x:-100,y:100,z:0},{x:-100,y:-100,z:0},{x:100,y:100,z:0},{x:100,y:-100,z:0},{x:-100,y:-100,z:0},{x:100,y:100,z:0}]},onRender:({uniforms:i})=>{let o={};if(e.onRender){e.onRender(o);for(let h in A)o[h]!==void 0&&(i[A[h]].value=o[h]);o[d]!==void 0&&(i.y.value=b(o[d]),i.B.value=o[d].length),o.width&&o.height&&(i.u.value=[o.width,o.height])}}}),s};export{F as default};
